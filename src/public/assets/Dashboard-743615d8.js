import{d as z,r,i as S,j as N,c as u,a as t,t as d,n as g,b as M,v as I,k as q,F as H,l as P,m as J,u as X,A,o as m,w,p as K,_ as Q}from"./index-d776bd83.js";import{G as L}from"./game-46c57cec.js";import{u as W}from"./useToast-686f79ff.js";const Z={class:"card"},ee={style:{display:"flex",gap:"15px","align-items":"center","flex-wrap":"wrap"}},te={style:{flex:"1","min-width":"250px"}},se={style:{display:"flex",gap:"10px","align-items":"center"}},ae={class:"checkbox-label",style:{display:"flex","align-items":"center",gap:"10px"}},ne={class:"games-grid"},oe={key:0,class:"empty-state"},re=["onClick"],ie={class:"game-card-header"},le={class:"game-info-column"},ce={class:"game-info-row"},ue={class:"game-name"},de={class:"game-owner"},me={class:"game-info-row"},ve={class:"game-card-actions"},pe=["onClick"],he=["onClick"],fe=["onClick"],_e=z({__name:"Dashboard",setup(ge){const p=X(),{addToast:h}=W(),y=r([]),E=r(!0),l=r(""),f=r(!1),$=r(),b=r(0),C=r(0),c=r(!1),v=r(!1),i=r(0),x=S(()=>A.getCurrentUser()),k=S(()=>{const a=y.value.filter(e=>{var o;const s=e.name.toLowerCase().includes(l.value.toLowerCase())||e.description&&e.description.toLowerCase().includes(l.value.toLowerCase())||((o=e.owner)==null?void 0:o.name)&&e.owner.name.toLowerCase().includes(l.value.toLowerCase()),n=!f.value||G(e);return s&&n});return a.sort((e,s)=>{const n=e.activeConnections||0;return(s.activeConnections||0)-n}),a.slice(0,10)});N(()=>{_()});const B=a=>{window.scrollY===0&&(b.value=a.touches[0].clientY,c.value=!0)},O=a=>{if(!c.value)return;C.value=a.touches[0].clientY;const e=Math.max(0,C.value-b.value),s=80,n=.1;if(e<=s)i.value=e;else{const o=e-s;i.value=s+o*n}i.value>10&&a.preventDefault()},R=()=>{if(c.value)if(c.value=!1,i.value>80)v.value=!0,_().finally(()=>{setTimeout(()=>{v.value=!1,i.value=0},500)});else{const a=i.value,e=Date.now(),s=300,n=()=>{const o=Date.now()-e,T=Math.min(o/s,1),j=1-Math.pow(1-T,3);i.value=a*(1-j),T<1&&requestAnimationFrame(n)};requestAnimationFrame(n)}},_=async()=>{try{const a=await L.getGames();y.value=a}catch(a){h({message:"Error loading games: "+a.message,type:"error"})}finally{E.value=!1}},G=a=>!a.owner||!x.value?!1:a.owner.id===x.value.id,U=async a=>{if(confirm("Are you sure you want to delete this game? This action cannot be undone."))try{await L.deleteGame(a),h({message:"Game deleted successfully",type:"success"}),_()}catch(e){h({message:"Error deleting game: "+e.message,type:"error"})}},D=a=>{p.push(`/game/${a.id}`)},Y=()=>{p.push("/create-game")},F=a=>{p.push(`/history?gameId=${a}`)},V=()=>{A.logout(),window.location.href="/login"};return(a,e)=>(m(),u("div",{class:g(["container",{dragging:c.value}]),style:J({transform:`translateY(${i.value}px)`}),ref_key:"containerRef",ref:$,onTouchstart:B,onTouchmove:O,onTouchend:R},[t("div",{class:"header flex justify-between items-center"},[e[2]||(e[2]=t("h1",null,"Dashboard - Milsim Games",-1)),t("div",{class:"flex gap-2"},[t("button",{class:"btn btn-success",onClick:Y}," Create Game "),t("button",{class:"btn btn-danger",onClick:V}," Logout ")])]),t("div",{class:g(["refresh-indicator",{active:v.value}])},[e[3]||(e[3]=t("div",{class:"refresh-spinner"},"⟳",-1)),t("span",null,d(v.value?"Actualizando...":"Soltar para actualizar"),1)],2),t("div",Z,[t("div",ee,[t("div",te,[M(t("input",{type:"text",placeholder:"Search by name, description or owner...",class:"form-input",style:{width:"100%"},"onUpdate:modelValue":e[0]||(e[0]=s=>l.value=s)},null,512),[[I,l.value]])]),t("div",se,[t("label",ae,[M(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=s=>f.value=s),style:{width:"20px",height:"20px"}},null,512),[[q,f.value]]),e[4]||(e[4]=t("span",null,"Mostrar solo mis juegos",-1))])])]),e[5]||(e[5]=t("div",{style:{height:"1px",background:"var(--border)",margin:"15px 0"}},null,-1)),t("div",ne,[k.value.length===0?(m(),u("div",oe," No games match the filters ")):(m(!0),u(H,{key:1},P(k.value,s=>{var n;return m(),u("div",{key:s.id,class:"game-card",onClick:o=>D(s)},[t("div",ie,[t("div",le,[t("div",ce,[t("span",ue,d(s.name),1),t("span",de,"Propietario: "+d(((n=s.owner)==null?void 0:n.name)||"Unknown"),1)]),t("div",me,[t("span",{class:g(`status-${s.status}`)},"Estado: "+d(s.status),3),t("span",null,"Jugadores: "+d(s.activeConnections||0),1)])]),t("div",ve,[t("button",{class:"btn btn-primary",onClick:w(o=>D(s),["stop"]),title:"Entrar al juego"}," 🚪 ",8,pe),t("button",{class:"btn btn-success",onClick:w(o=>F(s.id),["stop"]),title:"View Game History"}," 🕒 ",8,he),G(s)?(m(),u("button",{key:0,class:"btn btn-danger",onClick:w(o=>U(s.id),["stop"]),title:"Delete game"}," 🗑️ ",8,fe)):K("",!0)])])],8,re)}),128))])])],38))}});const Ce=Q(_e,[["__scopeId","data-v-9a664572"]]);export{Ce as default};
