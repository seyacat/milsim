import{d as z,r as l,i as S,j as N,c as u,a as t,t as d,n as _,b as A,v as q,k as I,F as H,l as P,m as J,u as X,A as M,o as m,w as y,p as K,_ as Q}from"./index-f447513b.js";import{G as L}from"./game-148831c5.js";import{u as W}from"./useToast-d2f086bf.js";const Z={class:"card"},ee={style:{display:"flex",gap:"15px","align-items":"center","flex-wrap":"wrap"}},te={style:{flex:"1","min-width":"250px"}},se={style:{display:"flex",gap:"10px","align-items":"center"}},ae={class:"checkbox-label",style:{display:"flex","align-items":"center",gap:"10px"}},ne={class:"games-grid"},oe={key:0,class:"empty-state"},le=["onClick"],re={class:"game-card-header"},ie={class:"game-info-column"},ce={class:"game-info-row"},ue={class:"game-name"},de={class:"game-owner"},me={class:"game-info-row"},ve={class:"game-card-actions"},pe=["onClick"],he=["onClick"],fe=["onClick"],ge=z({__name:"Dashboard",setup(_e){const p=X(),{addToast:h}=W(),w=l([]),E=l(!0),i=l(""),f=l(!1),$=l(),b=l(0),C=l(0),c=l(!1),v=l(!1),r=l(0),x=S(()=>M.getCurrentUser()),k=S(()=>{const a=w.value.filter(e=>{var o;const s=e.name.toLowerCase().includes(i.value.toLowerCase())||e.description&&e.description.toLowerCase().includes(i.value.toLowerCase())||((o=e.owner)==null?void 0:o.name)&&e.owner.name.toLowerCase().includes(i.value.toLowerCase()),n=!f.value||G(e);return s&&n});return a.sort((e,s)=>{const n=e.activeConnections||0;return(s.activeConnections||0)-n}),a.slice(0,25)});N(()=>{g()});const B=a=>{const e=document.querySelector(".games-grid");e&&e.scrollTop===0&&(b.value=a.touches[0].clientY,c.value=!0)},O=a=>{if(!c.value)return;C.value=a.touches[0].clientY;const e=Math.max(0,C.value-b.value),s=80,n=.1;if(e<=s)r.value=e;else{const o=e-s;r.value=s+o*n}r.value>10&&a.preventDefault()},R=()=>{if(c.value)if(c.value=!1,r.value>80)v.value=!0,g().finally(()=>{setTimeout(()=>{v.value=!1,r.value=0},500)});else{const a=r.value,e=Date.now(),s=300,n=()=>{const o=Date.now()-e,D=Math.min(o/s,1),j=1-Math.pow(1-D,3);r.value=a*(1-j),D<1&&requestAnimationFrame(n)};requestAnimationFrame(n)}},g=async()=>{try{const a=await L.getGames();w.value=a}catch(a){h({message:"Error loading games: "+a.message,type:"error"})}finally{E.value=!1}},G=a=>!a.owner||!x.value?!1:a.owner.id===x.value.id,U=async a=>{if(confirm("Are you sure you want to delete this game? This action cannot be undone."))try{await L.deleteGame(a),h({message:"Game deleted successfully",type:"success"}),g()}catch(e){h({message:"Error deleting game: "+e.message,type:"error"})}},T=a=>{p.push(`/game/${a.id}`)},F=()=>{p.push("/create-game")},V=a=>{p.push(`/history?gameId=${a}`)},Y=()=>{M.logout(),window.location.href="/login"};return(a,e)=>(m(),u("div",{class:_(["container",{dragging:c.value}]),style:J({transform:`translateY(${r.value}px)`}),ref_key:"containerRef",ref:$,onTouchstart:B,onTouchmove:O,onTouchend:R},[t("div",{class:"header flex justify-between items-center"},[e[2]||(e[2]=t("h1",null,"Dashboard - Milsim Games",-1)),t("div",{class:"flex gap-2"},[t("button",{class:"btn btn-success",onClick:F}," Create Game "),t("button",{class:"btn btn-danger",onClick:Y}," Logout ")])]),t("div",{class:_(["refresh-indicator",{active:v.value}])},[e[3]||(e[3]=t("div",{class:"refresh-spinner"},"⟳",-1)),t("span",null,d(v.value?"Actualizando...":"Soltar para actualizar"),1)],2),t("div",Z,[t("div",ee,[t("div",te,[A(t("input",{type:"text",placeholder:"Search by name, description or owner...",class:"form-input",style:{width:"100%"},"onUpdate:modelValue":e[0]||(e[0]=s=>i.value=s)},null,512),[[q,i.value]])]),t("div",se,[t("label",ae,[A(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=s=>f.value=s),style:{width:"20px",height:"20px"}},null,512),[[I,f.value]]),e[4]||(e[4]=t("span",null,"Mostrar solo mis juegos",-1))])])]),e[5]||(e[5]=t("div",{style:{height:"1px",background:"var(--border)",margin:"15px 0"}},null,-1)),t("div",ne,[k.value.length===0?(m(),u("div",oe," No games match the filters ")):(m(!0),u(H,{key:1},P(k.value,s=>{var n;return m(),u("div",{key:s.id,class:"game-card",onClick:o=>T(s)},[t("div",re,[t("div",ie,[t("div",ce,[t("span",ue,d(s.name),1),t("span",de,"Propietario: "+d(((n=s.owner)==null?void 0:n.name)||"Unknown"),1)]),t("div",me,[t("span",{class:_(`status-${s.status}`)},"Estado: "+d(s.status),3),t("span",null,"Jugadores: "+d(s.activeConnections||0),1)])]),t("div",ve,[t("button",{class:"btn btn-primary btn-small",onClick:y(o=>T(s),["stop"]),title:"Entrar al juego"}," 🚪 ",8,pe),t("button",{class:"btn btn-success btn-small",onClick:y(o=>V(s.id),["stop"]),title:"View Game History"}," 🕒 ",8,he),G(s)?(m(),u("button",{key:0,class:"btn btn-danger btn-small",onClick:y(o=>U(s.id),["stop"]),title:"Delete game"}," 🗑️ ",8,fe)):K("",!0)])])],8,le)}),128))])])],38))}});const Ce=Q(ge,[["__scopeId","data-v-39fc5f83"]]);export{Ce as default};
