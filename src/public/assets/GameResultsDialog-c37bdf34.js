import{d as P,r as f,i as T,s as $,c as l,a as t,m as g,t as n,F as m,l as p,w,o as a,n as D,e as _,_ as B}from"./index-7fbbb612.js";import{G as J}from"./game-8f7145f9.js";const F={class:"game-results-content"},N={key:0,class:"game-results-loading"},O={key:1,class:"game-results-error"},q={key:2},L={class:"game-results-section"},M={class:"game-results-table-container"},V={class:"game-results-table"},z={key:0,class:"game-results-section"},U={class:"game-results-table-container"},j={class:"game-results-table"},A={class:"game-results-team"},H={class:"totals-row"},K={key:1,class:"game-results-section"},Q={class:"game-results-table-container"},W={class:"game-results-table"},X={class:"game-results-team"},Y={class:"game-results-footer"},Z=P({__name:"GameResultsDialog",props:{isOpen:{type:Boolean},onClose:{type:Function},currentGame:{},gameId:{},isGameInstance:{type:Boolean}},setup(i){const d=i,o=f(null),b=f(!1),v=f(null),E=T(()=>{var u;return(u=o.value)!=null&&u.playerCaptureStats?[...o.value.playerCaptureStats].map(e=>({...e,captureCount:(e.codeCaptureCount||0)+(e.positionCaptureCount||0)})).sort((e,r)=>(r.captureCount||0)-(e.captureCount||0)):[]}),G=u=>{const e=Math.floor(u/60),r=u%60;return`${e.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`},R=u=>{const e=Math.floor(u/60),r=u%60;return`${e}:${r.toString().padStart(2,"0")}`},x=async()=>{var u;if(d.gameId){b.value=!0,v.value=null;try{let r=typeof d.gameId=="string"?parseInt(d.gameId):d.gameId;!d.isGameInstance&&((u=d.currentGame)!=null&&u.instanceId)&&(r=d.currentGame.instanceId);const y=await J.getGameResults(r);o.value=y}catch(e){console.error("Error loading game results:",e),v.value=e instanceof Error?e.message:"Error desconocido"}finally{b.value=!1}}};return $(()=>d.isOpen,u=>{u&&d.gameId&&x()}),(u,e)=>{var r,y,k,I,S;return i.isOpen?(a(),l("div",{key:0,class:"game-results-overlay",onClick:e[2]||(e[2]=(...s)=>i.onClose&&i.onClose(...s))},[t("div",{class:"game-results-dialog",onClick:e[1]||(e[1]=w(()=>{},["stop"]))},[e[13]||(e[13]=t("div",{class:"game-results-header"},[t("h3",{class:"game-results-title"},"Resumen del Juego"),t("p",{class:"game-results-subtitle"},"¡Juego Finalizado!")],-1)),t("div",F,[b.value?(a(),l("div",N," Cargando resultados del juego... ")):g("",!0),v.value?(a(),l("div",O,n(v.value),1)):g("",!0),!b.value&&!v.value&&o.value?(a(),l("div",q,[t("div",L,[e[7]||(e[7]=t("h4",{class:"game-results-section-title"},"Resumen General",-1)),t("div",M,[t("table",V,[t("tbody",null,[t("tr",null,[e[3]||(e[3]=t("td",null,[t("strong",null,"Duración:")],-1)),t("td",null,n(R(o.value.gameDuration)),1)]),t("tr",null,[e[4]||(e[4]=t("td",null,[t("strong",null,"Jugadores:")],-1)),t("td",null,n(((y=(r=i.currentGame)==null?void 0:r.players)==null?void 0:y.length)||0),1)]),t("tr",null,[e[5]||(e[5]=t("td",null,[t("strong",null,"Equipos:")],-1)),t("td",null,n(((k=i.currentGame)==null?void 0:k.teamCount)||2),1)]),t("tr",null,[e[6]||(e[6]=t("td",null,[t("strong",null,"Puntos de control:")],-1)),t("td",null,n(((S=(I=i.currentGame)==null?void 0:I.controlPoints)==null?void 0:S.length)||0),1)])])])])]),o.value.controlPoints&&o.value.controlPoints.length>0?(a(),l("div",z,[e[10]||(e[10]=t("h4",{class:"game-results-section-title"},"Resultados por Equipos",-1)),t("div",U,[t("table",j,[t("thead",null,[t("tr",null,[e[8]||(e[8]=t("th",null,"Punto de Control",-1)),(a(!0),l(m,null,p(o.value.teams,s=>(a(),l("th",{key:s,colspan:"2"},[t("div",A,[t("div",{class:D(`team-color ${s}`)},null,2),_(" "+n(s.toUpperCase()),1)])]))),128))])]),t("tbody",null,[(a(!0),l(m,null,p(o.value.controlPoints,s=>(a(),l("tr",{key:s.id},[t("td",null,n(s.name),1),(a(!0),l(m,null,p(o.value.teams,c=>{var C,h;return a(),l(m,{key:c},[t("td",null,n(G(((C=s.teamTimes)==null?void 0:C[c])||0)),1),t("td",null,n(((h=s.teamCaptures)==null?void 0:h[c])||0),1)],64)}),128))]))),128)),t("tr",H,[e[9]||(e[9]=t("td",null,[t("strong",null,"TOTAL")],-1)),(a(!0),l(m,null,p(o.value.teams,s=>{var c,C;return a(),l(m,{key:s},[t("td",null,[t("strong",null,n(G(((c=o.value.teamTotals)==null?void 0:c[s])||0)),1)]),t("td",null,[t("strong",null,n(((C=o.value.teamCaptureTotals)==null?void 0:C[s])||0),1)])],64)}),128))])])])])])):g("",!0),o.value.playerCaptureStats?(a(),l("div",K,[e[12]||(e[12]=t("h4",{class:"game-results-section-title"},"Resultados por Jugador",-1)),t("div",Q,[t("table",W,[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",null,"Jugador"),t("th",null,"Equipo"),t("th",null,"Capturas"),t("th",null,"Desactivaciones"),t("th",null,"Explosiones")])],-1)),t("tbody",null,[(a(!0),l(m,null,p(E.value,s=>(a(),l("tr",{key:s.userId},[t("td",null,n(s.userName),1),t("td",null,[t("div",X,[t("div",{class:D(`team-color ${s.team}`)},null,2),_(" "+n(s.team.toUpperCase()),1)])]),t("td",null,n(s.captureCount||0),1),t("td",null,n(s.bombDeactivationCount||0),1),t("td",null,n(s.bombExplosionCount||0),1)]))),128))])])])])):g("",!0)])):g("",!0)]),t("div",Y,[t("button",{class:"btn btn-secondary",onClick:e[0]||(e[0]=(...s)=>i.onClose&&i.onClose(...s))}," Cerrar ")])])])):g("",!0)}}});const st=B(Z,[["__scopeId","data-v-3d2eb2ba"]]);export{st as G};
